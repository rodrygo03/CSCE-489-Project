"""
Query forward index and reverse index for 
∞-gram next-token distribution to verify them
"""

import argparse
import os
import sys

from infini_gram.engine import InfiniGramEngine
from transformers import AutoTokenizer

def parse_args():
    parser = argparse.ArgumentParser(
        description="Sanity-check a local Infini-gram index (nucleotide tokenizer)."
    )
    parser.add_argument(
        "--index_dir",
        type=str,
        required=True,
        help="Directory containing the index (offset.0, table.0, tokenized.0).",
    )
    parser.add_argument(
        "--tokenizer_path",
        type=str,
        required=True,
        help="Local path to nucleotide transformer tokenizer (same as used for indexing).",
    )
    parser.add_argument(
        "--test_seqs",
        type=str,
        nargs="*",
        default=["ACGTACGT", "AAAAAA", "GGGTTTAAA"],
        help="Optional list of DNA sequences to probe the index with.",
    )
    parser.add_argument(
        "--max_disp_len",
        type=int,
        default=50,
        help="Max display length when fetching docs (if you enable those tests later).",
    )
    return parser.parse_args()


def load_tokenizer(path):
    tokenizer = AutoTokenizer.from_pretrained(path, use_fast=True, local_files_only=True,)
    
    print(f"eos_token_id={tokenizer.eos_token_id}")
    print(f"pad_token_id={tokenizer.pad_token_id}\n")

    return tokenizer


def encode_seq(tokenizer, seq):
    encoded = tokenizer(seq, add_special_tokens=False, return_attention_mask=False, return_token_type_ids=False)
    return encoded["input_ids"]


def load_engine(index_dir: str, tokenizer):
    """
    Given index dir 
    return InfiniGramEngine based on given index in dir
    """
    eos_id = tokenizer.eos_token_id
    if eos_id is None:
        eos_id = tokenizer.pad_token_id
    if eos_id is None:
        # fallback just in case
        eos_id = 0

    print(f"instantiating InfiniGramEngine with eos_token_id={eos_id}...")
    engine = InfiniGramEngine(index_dir=index_dir, eos_token_id=eos_id)
    print("Engine instantiated.\n")

    return engine

 
def test_infini_nextprob(engine, tokenizer, seq):
    """
    Probe the ∞-gram next-token distribution on a real genomic sequence.
    """
    print("[TEST] ∞-gram next-token distribution on a genomic sequence")
    print(f"  Raw sequence (len={len(seq)}): {seq[:60]}...")

    # Encode with nucleotide tokenizer (no special tokens)
    input_ids = encode_seq(tokenizer, seq)
    prompt_ids = input_ids[:-1]
    true_next_id = input_ids[-1]

    print("Prompt tokens:", prompt_ids)
    print("True next token:", true_next_id)

    # ∞-gram next-token distribution
    ntd = engine.infgram_ntd(prompt_ids=prompt_ids, max_support=2000)
    print("NTD:", ntd)

    # Probability of the true next token
    prob = engine.infgram_prob(prompt_ids=prompt_ids, cont_id=true_next_id)
    print("Next-token prob:", prob)


def main():
    args = parse_args()
    if not os.path.isdir(args.index_dir):
        print(f"index_dir does not exist or is not a directory: {args.index_dir}")
        sys.exit(1)

    tokenizer = load_tokenizer(args.tokenizer_path)
    engine = load_engine(args.index_dir, tokenizer)

    # ∞-gram next-token distribution
    seq1 = (
        "CATCTGCAGGTGTCTGACTTCCAGCAACTGCTGGCCTGTGCCAGGGTGCAAGCTGAGCACTGGAGTGGAGTTTTCCTGTGGAGAGGAGCCATGCCTAGAGTGGGATGGGCCATTGTTCATCTTCTGGCCCCTGTTGTCTGCATGTAACTTAATACCACAACCAGGCATAGGGGAAAGATTGGAGGAAAGATGAGTGAGAGCATCAACTTCTCTCACAACCTAGGCCAGTAAGTAGTGCTTGTGCTCATCTCCTTGGCTGTGATACGTGGCCGGCCCTCGCTCCAGCAGCTGGACCCCTACCTGCCGTCTGCTGCCATCGGAGCCCAAAGCCGGGCTGTGACTGCTCAGACCAGCCGGCTGGAGGGAGGGGCTCAGCAGGTCTGGCTTTGGCCCTGGGAGAGCAGGTGGAAGATCAGGCAGGCCATCGCTGCCACAGAACCCAGTGGATTGGCCTAGGTGGGATCTCTGAGCTCAACAAGCCCTCTCTGGGTGGTAGGTGCAGAGACGGGAGGGGCAGAGCCGCAGGCACAGCCAAGAGGGCTGAAGAAATGGTAGAACGGAGCAGCTGGTGATGTGTGGGCCCACCGGCCCCAGGCTCCTGTCTCCCCCCAGGTGTGTGGTGATGCCAGGCATGCCCTTCCCCAGCATCAGGTCTCCAGAGCTGCAGAAGACGACGGCCGACTTGGATCACACTCTTGTGAGTGTCCCCAGTGTTGCAGAGGTGAGAGGAGAGTAGACAGTGAGTGGGAGTGGCGTCGCCCCTAGGGCTCTACGGGGCCGGCGTCTCCTGTCTCCTGGAGAGGCTTCGATGCCCCTCCACACCCTCTTGATCTTCCCTGTGATGTCATCTGGAGCCCTGCTGCTTGCGGTGGCCTATAAAGCCTCCTAGTCTGGCTCCAAGGCCTGGCAGAGTCTTTCCCAGGGAAAGCTACAAGCAGCAAACAGTCTGCATGGGTCATCCCCTTCACTCCCAGCTCAGAGCCCAGGCCAGGGGCCCCCAAGAAAGGCTCTGGTGGAGAACCTGTGCATGAAGGCTGTCAACCAGTCCATAGGCAAGCCTGGCTGCCTCCAGCTGGGTCGACAGACAGGGGCTGGAGAAGGGGAGAAGAGGAAAGTGAGGTTGCCTGCCCTGTCTCCTACCTGAGGCTGAGGAAGGAGAAGGGGATGCACTGTTGGGGAGGCAGCTGTAACTCAAAGCCTTAGCCTCTGTTCCCACGAAGGCAGGGCCATCAGGCACCAAAGGGATTCTGCCAGCATAGTGCTCCTGGACCAGTGATACACCCGGCACCCTGTCCTGGACACGCTGTTGGCCTGGATCTGAGCCCTGGTGGAGGTCAAAGCCACCTTTGGTTCTGCCATTGCTGCTGTGTGGAAGTTCACTCCTGCCTTTTCCTTTCCCTAGAGCCTCCACCACCCCGAGATCACATTTCTCACTGCCTTTTGTCTGCCCAGTTTCACCAGAAGTAGGCCTCTTCCTGACAGGCAGCTGCACCACTGCCTGGCGCTGTGCCCTTCCTTTGCTCTGCCCGCTGGAGACGGTGTTTGTCATGGGCCTGGTCTGCAGGGATCCTGCTACAAAGGTGAAACCCAGGAGAGTGTGGAGTCCAGAGTGTTGCCAGGACCCAGGCACAGGCATTAGTGCCCGTTGGAGAAAACAGGGGAATCCCGAAGAAATGGTGGGTCCTGGCCATCCGTGAGATCTTCCCAGGGCAGCTCCCCTCTGTGGAATCCAATCTGTCTTCCATCCTGCGTGGCCGAGGGCCAGGCTTCTCACTGGGCCTCTGCAGGAGGCTGCCATTTGTCCTGCCCACCTTCTTAGAAGCGAGACGGAGCAGACCCATCTGCTACTGCCCTTTCTATAATAACTAAAGTTAGCTGCCCTGGACTATTCACCCCCTAGTCTCAATTTAAGAAGATCCCCATGGCCACAGGGCCCCTGCCTGGGGGCTTGTCACCTCCCCCACCTTCTTCCTGAGTCATTCCTGCAGCCTTGCTCCCTAACCTGCCCCACAGCCTTGCCTGGATTTCTATCTCCCTGGCTTGGTGCCAGTTCCTCCAAGTCGATGGCACCTCCCTCCCTCTCAACCACTTGAGCAAACTCCAAGACATCTTCTACCCCAACACCAGCAATTGTGCCAAGGGCCATTAGGCTCTCAGCATGACTATTTTTAGAGACCCCGTGTCTGTCACTGAAACCTTTTTTGTGGGAGACTATTCCTCCCATCTGCAACAGCTGCCCCTGCTGACTGCCCTTCTCTCCTCCCTCTCATCCCAGAGAAACAGGTCAGCTGGGAGCTTCTGCCCCCACTGCCTAGGGACCAACAGGGGCAGGAGGCAGTCACTGACCCCGAGACGTTTGCATCCTGCACAGCTAGAGATCCTTTATTAAAAGCACACTGTTGGTTTCTGCTCAGTTCTTTATTGATTGGTGTGCCGTTTTCTCTGGAAGCCTCTTAAGAACACAGTGGCGCAGGCTGGGTGGAGCCGTCCCCCCATGGAGCACAGGCAGACAGAAGTCCCCGCCCCAGCTGTGTGGCCTCAAGCCAGCCTTCCGCTCCTTGAAGCTGGTCTCCACACAGTGCTGGTTCCGTCACCCCCTCCCAAGGAAGTAGGTCTGAGCAGCTTGTCCTGGCTGTGTCCATGTCAGAGCAACGGCCCAAGTCTGGGTCTGGGGGGGAAGGTGTCATGGAGCCCCCTACGATTCCCAGTCGTCCTCGTCCTCCTCTGCCTGTGGCTGCTGCGGTGGCGGCAGAGGAGGGATGGAGTCTGACACGCGGGCAAAGGCTCCTCCGGGCCCCTCACCAGCCCCAGGTCCTTTCCCAGAGATGCCTGGAGGGAAAAGGCTGAGTGAGGGTGGTTGGTGGGAAACCCTGGTTCCCCCAGCCCCCGGAGACTTAAATACAGGAAGAAAAAGGCAGGACAGAATTACAAGGTGCTGGCCCAGGGCGGGCAGCGGCCCTGCCTCCTACCCTTGCGCCTCATGACCAGCTTGTTGAAGAGATCCGACATCAAGTGCCCACCTTGGCTCGTGGCTCTCACTGCAACGGGAAAGCCACAGACTGGGGTGAAGAGTTCAGTCACATGCGACCGGTGACTCCCTGTCCCCACCCCCATGACACTCCCCAGCCCTCCAAGGCCACTGTGTTTCCCAGTTAGCTCAGAGCCTCAGTCGATCCCTGACCCAGCACCGGGCACTGATGAGACAGCGGCTGTTTGAGGAGCCACCTCCCAGCCACCTCGGGGCCAGGGCCAGGGTGTGCAGCACCACTGTACAATGGGGAAACTGGCCCAGAGAGGTGAGGCAGCTTGCCTGGGGTCACAGAGCAAGGCAAAAGCAGCGCTGGGTACAAGCTCAAAACCATAGTGCCCAGGGCACTGCCGCTGCAGGCGCAGGCATCGCATCACACCAGTGTCTGCGTTCACAGCAGGCATCATCAGTAGCCTCCAGAGGCCTCAGGTCCAGTCTCTAAAAATATCTCAGGAGGCTGCAGTGGCTGACCATTGCCTTGGACCGCTCTTGGCAGTCGAAGAAGATTCTCCTGTCAGTTTGAGCTGGGTGAGCTTAGAGAGGAAAGCTCCACTATGGCTCCCAAACCAGGAAGGAGCCATAGCCCAGGCAGGAGGGCTGAGGACCTCTGGTGGCGGCCCAGGGCTTCCAGCATGTGCCCTAGGGGAAGCAGGGGCCAGCTGGCAAGAGCAGGGGGTGGGCAGAAAGCACCCGGTGGACTCAGGGCTGGAGGGGAGGAGGCGATCTTGCCCAAGGCCCTCCGACTGCAAGCTCCAGGGCCCGCTCACCTTGCTCCTGCTCCTTCTGCTGCTGCTTCTCCAGCTTTCGCTCCTTCATGCTGCGCAGCTTGGCCTTGCCGATGCCCCCAGCTTGGCGGATGGACTCTAGCAGAGTGGCCAGCCACCGGAGGGGTCAACCACTTCCCTGGGAGCTCCCTGGACTGGAGCCGGGAGGTGGGGAACAGGGCAAGGAGGAAAGGCTGCTCAGGCAGGGCTGGGGAAGCTTACTGTGTCCAAGAGCCTGCTGGGAGGGAAGTCACCTCCCCTCAAACGAGGAGCCCTGCGCTGGGGAGGCCGGACCTTTGGAGACTGTGTGTGGGGGCCTGGGCACTGACTTCTGCAACCACCTGAGCGCGGGCATCCTGTGTGCAGATACTCCCTGCTTCCTCTCTAGCCCCCACCCTGCAGAGCTGGACCCCTGAGCTAGCCATGCTCTGACAGTCTCAGTTGCACACACGAGCCAGCAGAGGGGTTTTGTGCCACTTCTGGATGCTAGGGTTACACTGGGAGACACAGCAGTGAAGCTGAAATGAAAAATGTGTTGCTGTAGTTTGTTATTAGACCCCTTCTTTCCATTGGTTTAATTAGGAATGGGGAACCCAGAGCCTCACTTGTTCAGGCTCCCTCTGCCCTAGAAGTGAGAAGTCCAGAGCTCTACAGTTTGAAAACCACTATTTTATGAACCAAGTAGAACAAGATATTTGAAATGGAAACTATTCAAAAAATTGAGAATTTCTGACCACTTAACAAACCCACAGAAAATCCACCCGAGTGCACTGAGCACGCCAGAAATCAGGTGGCCTCAAAGAGCTGCTCCCACCTGAAGGAGACGCGCTGCTGCTGCTGTCGTCCTGCCTGGCGCCTTGGCCTACAGGGGCCGCGGTTGAGGGTGGGAGTGGGGGTGCACTGGCCAGCACCTCAGGAGCTGGGGGTGGTGGTGGGGGCGGTGGGGGTGGTGTTAGTACCCCATCTTGTAGGTCTGAAACACAAAGTGTGGGGTGTCTAGGGAAGAAGGTGTGTGACCAGGGAGGTCCCCGGCCCAGCTCCCATCCCAGAACCCAGCTCACCTACCTTGAGAGGCTCGGCTACCTCAGTGTGGAAGGTGGGCAGTTCTGGAATGGTGCCAGGGGCAGAGGGGGCAATGCCGGGGCCCAGGTCGGCAATGTACATGAGGTCGTTGGCAATGCCGGGCAGGTCAGGCAGGTAGGATGGAACATCAATCTCAGGCACCTGGCCCAGGTCTGGCACATAGAAGTAGTTCTCTGGGACCTGCAAGATTAGGCAGGGACATGTGAGAGGTGACAGGGACCTGCAGGGGCAGCCAACAAGACCTTGTGTGCACCTCCCATGGGTGGAATAAGGGGCCCAACAGCCTTGACTGGAGAGGAGCTCTGGCAAGGCCCTGGGCCACTGCACCTGTCTCCACCTCTGTCCCACCCCTCCCACCTGCTGTTCCAGCTGCTCTCTCTTGCTGATGGACAAGGGGGCATCAAACAGCTTCTCCTCTGTCTCTGCCCCCAGCATCACATGGGTCTTTGTTACAGCACCAGCCAGGGGGTCCAGGAAGACATACTTCTTCTACCTACAGAGGCGACATGGGGGTCAGGCAAGCTGACACCCGCTGTCCTGAGCCCATGTTCCTCTCCCACATCATCAGGGGCACAGCGTGCACTGTGGGGTCCCAGGCCTCCCGAGCCGAGCCACCCGTCACCCCCTGGCTCCTGGCCTATGTGCTGTACCTGTGTCTGATGCCCTGGGTCCCCACTAAGCCAGGCCGGGCCTCCCGCCCACACCCCTCGGCCCTGCCCTCTGGCCATACAGGTTCTCGGTGGTGTTGAAGAGCAGCAAGGAGCTGACAGAGCTGATGTTGCTGGGAAGACCCCCAAGTCCCTCTTCTGCATCGTCCTCGGGCTCCGGCTTGGTGCTCACGCACACAGGAAAGTCCTTCAGCTTCTCCTGAGAGGGCCAGGATGGCCAAGGGATGGTGAATATTTGGTGCTGGGCCTAATCAGCTGCCATCCCATCCCAGTCAGCCTCCTCTGGGGGACAGAACCCTATGGTGGCCCCGGCTCCTCCCCAGTATCCAGTCCTCCTGGTGTGTGACAGGCTATATGCGCGGCCAGCAGACCTGCAGGGCCCGCTCGTCCAGGGGGCGGTGCTTGCTCTGGATCCTGTGGCGGGGGCGTCTCTGCAGGCCAGGGTCCTGGGCGCCCGTGAAGATGGAGCCATATTCCTGCAGGCGCCCTGGAGCAGGGTACTTGGCACTGGAGAACACCTGTGGACACAGGGACAAGTCTGAGGGGGCCCCAAGAGGCTCAGAGGGCTAGGATTGCTTGGCAGGAGAGGGTGGAGTTGGAAGCCTGGGCGAGAAGAAAGCTCAAGGTACAGGTGGGCAGCAGGGCAGAGACTGGGCA"
    )
    test_infini_nextprob(engine, tokenizer, seq1)
    print()
    seq2 = (
        "ACGGGTCAGAGACGGGACGACGGGTGGACATGGAACTCGAAAGAAGAGCGGGTCCGAAGGTTGAGGTGGGAGAGGACGGTTCGTTAGGATCGGGAGACTCGGAGAACCCCGGGGGAGTCTGAACAGGGACACAGGTGTCCACAAGAGGTCACGGTTCATGGGACGAGGTCCCGCGGACGTCCTTATACCGAGGTAGAAGTGCCCGCGGGTCCTGGGACCGGACGTCTCTGCGGGGGCGGTGTCCTAGGTCTCGTTCGTGGCGGGGGACCTGCTCGCCCGGGACGTCCAGACGACCGGCGCGTATATCGGACAGTGTGTGGTCCTCCTGACCTATGACCCCTCCTCGGCCCCGGTGGTATCCCAAGACAGGGGGTCTCCTCCGACTGACCCTACCCTACCGTCGACTAATCCGGGTCGTGGTTTATAAGTGGTAGGGAACCGGTAGGACCGGGAGAGTCCTCTTCGACTTCCTGAAAGGACACACGCACTCGTGGTTCGGCCTCGGGCTCCTGCTACGTCTTCTCCCTGAACCCCCAGAAGGGTCGTTGTAGTCGAGACAGTCGAGGAACGACGAGAAGTTGTGGTGGCTCTTGGACATACCGGTCTCCCGTCCCGGCTCCCCACACCCGCCCTCCGGGCCGGACCGAATCACCCCTGGGTCCCGTAGTCTGTGTCCATGTCGTGTATCCGGTCCTCGGTCCCCCACTGCCCACCGAGCCGAGCCCTCCGGACCCTGGGGTGTCACGTGCGACACGGGGACTACTACACCCTCTCCTTGTACCCGAGTCCTGTCGCCCACAGTCGAACGGACTGGGGGTACAGCGGAGACATCCATCTTCTTCATACAGAAGGACCTGGGGGACCGACCACGACATTGTTTCTGGGTACACTACGACCCCCGTCTCTGTCTCCTCTTCGACAAACTACGGGGGAACAGGTAGTCGTTCTCTCTCGTCGACCTTGTCGTCCACCCTCCCCACCCTGTCTCCACCTCTGTCCACGTCACCGGGTCCCGGAACGGTCTCGAGGAGAGGTCAGTTCCGACAACCCGGGGAATAAGGTGGGTACCCTCCACGTGTGTTCCAGAACAACCGACGGGGACGTCCAGGGACAGTGGAGAGTGTACAGGGACGGATTAGAACGTCCAGGGTCTCTTGATGAAGATACACGGTCTGGACCCGGTCCACGGACTCTAACTACAAGGTAGGATGGACGGACTGGACGGGCCGTAACGGTTGCTGGAGTACATGTAACGGCTGGACCCGGGGCCGTAACGGGGGAGACGGGGACCGTGGTAAGGTCTTGACGGGTGGAAGGTGTGACTCCATCGGCTCGGAGAGTTCCATCCACTCGACCCAAGACCCTACCCTCGACCCGGCCCCTGGAGGGACCAGTGTGTGGAAGAAGGGATCTGTGGGGTGTGAAACACAAAGTCTGGATGTTCTACCCCATGATTGTGGTGGGGGTGGCGGGGGTGGTGGTGGGGGTCGAGGACTCCACGACCGGTCACGTGGGGGTGAGGGTGGGAGTTGGCGCCGGGGACATCCGGTTCCGCGGTCCGTCCTGCTGTCGTCGTCGTCGCGCAGAGGAAGTCCACCCTCGTCGAGAAACTCCGGTGGACTAAAGACCGCACGAGTCACGTGAGCCCACCTAAAAGACACCCAAACAATTCACCAGTCTTTAAGAGTTAAAAAACTTATCAAAGGTAAAGTTTATAGAACAAGATGAACCAAGTATTTTATCACCAAAAGTTTGACATCTCGAGACCTGAAGAGTGAAGATCCCGTCTCCCTCGGACTTGTTCACTCCGAGACCCAAGGGGTAAGGATTAATTTGGTTACCTTTCTTCCCCAGATTATTGTTTGATGTCGTTGTGTAAAAAGTAAAGTCGAAGTGACGACACAGAGGGTCACATTGGGATCGTAGGTCTTCACCGTGTTTTGGGGAGACGACCGAGCACACACGTTGACTCTGACAGTCTCGTACCGATCGAGTCCCCAGGTCGAGACGTCCCACCCCCGATCTCTCCTTCGTCCCTCATAGACGTGTGTCCTACGGGCGCGAGTCCACCAACGTCTTCAGTCACGGGTCCGGGGGTGTGTGTCAGAGGTTTCCAGGCCGGAGGGGTCGCGTCCCGAGGAGCAAACTCCCCTCCACTGAAGGGAGGGTCGTCCGAGAACCTGTGTCATTCGAAGGGGTCGGGACGGACTCGTCGGAAAGGAGGAACGGGACAAGGGGTGGAGGGCCGAGGTCAGGTCCCTCGAGGGTCCCTTCACCAACTGGGGAGGCCACCGACCGGTGAGACGATCTCAGGTAGGCGGTTCGACCCCCGTAGCCGTTCCGGTTCGACGCGTCGTACTTCCTCGCTTTCGACCTCTTCGTCGTCGTCTTCCTCGTCCTCGTTCCACTCGCCCGGGACCTCGAACGTCAGCCTCCCGGAACCCGTTCTAGCGGAGGAGGGGAGGTCGGGACTCAGGTGGCCCACGAAAGACGGGTGGGGGACGAGAACGGTCGACCGGGGACGAAGGGGATCCCGTGTACGACCTTCGGGACCCGGCGGTGGTCTCCAGGAGTCGGGAGGACGGACCCGATACCGAGGAAGGACCAAACCCTCGGTATCACCTCGAAAGGAGAGATTCGAGTGGGTCGAGTTTGACTGTCCTCTTAGAAGAAGCTGACGGTTCTCGCCAGGTTCCGTTACCAGTCGGTGACGTCGGAGGACTCTATAAAAATCTCTGACCTGGACTCCGGAGACCTCCGATGACTACTACGGACGACACTTGCGTCTGTGACCACACTACGCTACGGACGCGGACGTCGCCGTCACGGGACCCGTGATACCAAAACTCGAACATGGGTCGCGACGAAAACGGAACGAGACACTGGGGTCCGTTCGACGGAGTGGAGAGACCCGGTCAAAGGGGTAACATGTCACCACGACGTGTGGGACCGGGACCGGGGCTCCACCGACCCTCCACCGAGGAGTTTGTCGGCGACAGAGTAGTCACGGGCCACGACCCAGTCCCTAGCTGACTCCGAGACTCGATTGACCCTTTGTGTCACCGGAACCTCCCGACCCCTCACAGTACCCCCACCCCTGTCCCTCAGTGGCCAGCGTACACTGACTTGAGAAGTGGGGTCAGACACCGAAAGGGCAACGTCACTCTCGGTGCTCGGTTCCACCCGTGAACTACAGCCTAGAGAAGTTGTTCGACCAGTACTCCGCGTTCCCATCCTCCGTCCCGGCGACGGGCGGGACCCGGTCGTGGAACATTAAGACAGGACGGAAAAAGAAGGACATAAATTCAGAGGCCCCCGACCCCCTTGGTCCCAAAGGGTGGTTGGTGGGAGTGAGTCGGAAAAGGGAGGTCCGTAGAGACCCTTTCCTGGACCCCGACCACTCCCCGGGCCTCCTCGGAAACGGGCGCACAGTCTGAGGTAGGGAGGAGACGGCGGTGGCGTCGTCGGTGTCCGTCTCCTCCTGCTCCTGCTGACCCTTAGCATCCCCCGAGGTACTGTGGAAGGGGGGGTCTGGGTCTGAACCCGGCAACGAGACTGTACCTGTGTCGGTCCTGTTCGACGAGTCTGGATGAAGGAACCCTCCCCCACTGCCTTGGTCGTGACACACCTCTGGTCGAAGTTCCTCGCCTTCCGACCGAACTCCGGTGTGTCGACCCCGCCCCTGAAGACAGACGGACACGAGGTACCCCCCTGCCGAGGTGGGTCGGACGCGGTGACACAAGAATTCTCCGAAGGTCTCTTTTGCCGTGTGGTTAGTTATTTCTTGACTCGTCTTTGGTTGTCACACGAAAATTATTTCCTAGAGATCGACACGTCCTACGTTTGCAGAGCCCCAGTCACTGACGGAGGACGGGGACAACCAGGGATCCGTCACCCCCGTCTTCGAGGGTCGACTGGACAAAGAGACCCTACTCTCCCTCCTCTCTTCCCGTCAGTCGTCCCCGTCGACAACGTCTACCCTCCTTATCAGAGGGTGTTTTTTCCAAAGTCACTGTCTGTGCCCCAGAGATTTTTATCAGTACGACTCTCGGATTACCGGGAACCGTGTTAACGACCACAACCCCATCTTCTACAGAACCTCAAACGAGTTCACCAACTCTCCCTCCCTCCACGGTAGCTGAACCTCCTTGACCGTGGTTCGGTCCCTCTATCTTTAGGTCCGTTCCGACACCCCGTCCAATCCCTCGTTCCGACGTCCTTACTGAGTCCTTCTTCCACCCCCTCCACTGTTCGGGGGTCCGTCCCCGGGACACCGGTACCCCTAGAAGAATTTAACTCTGATCCCCCACTTATCAGGTCCCGTCGATTGAAATCAATAATATCTTTCCCGTCATCGTCTACCCAGACGAGGCAGAGCGAAGATTCTTCCACCCGTCCTGTTTACCGTCGGAGGACGTCTCCGGGTCACTCTTCGGACCGGGAGCCGGTGCGTCCTACCTTCTGTCTAACCTAAGGTGTCTCCCCTCGACGGGACCCTTCTAGAGTGCCTACCGGTCCTGGGTGGTAAAGAAGCCCTAAGGGGACAAAAGAGGTTGCCCGTGATTACGGACACGGACCCAGGACCGTTGTGAGACCTGAGGTGTGAGAGGACCCAAAGTGGAAACATCGTCCTAGGGACGTCTGGTCCGGGTACTGTTTGTGGCAGAGGTCGCCCGTCTCGTTTCCTTCCCGTGTCGCGGTCCGTCACCACGTCGACGGACAGTCCTTCTCCGGATGAAGACCACTTTGACCCGTCTGTTTTCCGTCACTCTTTACACTAGAGCCCCACCACCTCCGAGATCCCTTTCCTTTTCCGTCCTCACTTGAAGGTGTGTCGTCGTTACCGTCTTGGTTTCCACCGAAACTGGAGGTGGTCCCGAGTCTAGGTCCGGTTGTCGCACAGGTCCTGTCCCACGGCCCACATAGTGACCAGGTCCTCGTGATACGACCGTCTTAGGGAAACCACGGACTACCGGGACGGAAGCACCCTTGTCTCCGATTCCGAAACTCAATGTCGACGGAGGGGTTGTCACGTAGGGGAAGAGGAAGGAGTCGGAGTCCATCCTCTGTCCCGTCCGTTGGAGTGAAAGGAGAAGAGGGGAAGAGGTCGGGGACAGACAGCTGGGTCGACCTCCGTCGGTCCGAACGGATACCTGACCAACTGTCGGAAGTACGTGTCCAAGAGGTGGTCTCGGAAAGAACCCCCGGGGACCGGACCCGAGACTCGACCCTCACTTCCCCTACTGGGTACGTCTGACAAACGACGAACATCGAAAGGGACCCTTTCTGAGACGGTCCGGAACCTCGGTCTGATCCTCCGAAATATCCGGTGGCGTTCGTCGTCCCGAGGTCTACTGTAGTGTCCCTTCTAGTTCTCCCACACCTCCCCGTAGCTTCGGAGAGGTCCTCTGTCCTCTGCGGCCGGGGCATCTCGGGATCCCCGCTGCGGTGAGGGTGAGTGACAGATGAGAGGAGAGTGGAGACGTTGTGACCCCTGTGAGTGTTCTCACACTAGGTTCAGCCGGCAGCAGAAGACGTCGAGACCTCTGGACTACGACCCCTTCCCGTACGGACCGTAGTGGTGTGTGGACCCCCCTCTGTCCTCGGACCCCGGCCACCCGGGTGTGTAGTGGTCGACGAGGCAAGATGGTAAAGAAGTCGGGAGAACCGACACGGACGCCGAGACGGGGAGGGCAGAGACGTGGATGGTGGGTCTCTCCCGAACAACTCGAGTCTCTAGGGTGGATCCGGTTAGGTGACCCAAGACACCGTCGCTACCGGACGGACTAGAAGGTGGACGAGAGGGTCCCGGTTTCGGTCTGGACGACTCGGGGAGGGAGGTCGGCCGACCAGACTCGTCAGTGTCGGGCCGAAACCCGAGGCTACCGTCGTCTGCCGTCCATCCCCAGGTCGACGACCTCGCTCCCGGCCGGTGCATAGTGTCGGTTCCTCTACTCGTGTTCGTGATGAATGACCGGATCCAACACTCTCTTCAACTACGAGAGTGAGTAGAAAGGAGGTTAGAAAGGGGATACGGACCAACACCATAATTCAATGTACGTCTGTTGTCCCCGGTCTTCTACTTGTTACCGGGTAGGGTGAGATCCGTACCGAGGAGAGGTGTCCTTTTGAGGTGAGGTCACGAGTCGAACGTGGGACCGTGTCCGGTCGTCAACGACCTTCAGTCTGTGGACGTCTAC"
    )
    test_infini_nextprob(engine, tokenizer, seq2)
    print("done.")


if __name__ == "__main__":
    main()
